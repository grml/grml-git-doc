Documentation of sip-vcs setup
==============================

Activate backports and install software
---------------------------------------

  cat >> /etc/apt/sources.list << EOF
  deb http://www.backports.org/debian etch-backports main contrib non-free
  EOF

  aptitude update
  aptitute install debian-backports-keyring gpm asciidoc

  cat > /etc/apt/preferences << EOF
  Package: git-core
  Pin: release a=etch-backports
  Pin-Priority: 999

  Package: git-buildpackage
  Pin: release a=etch-backports
  Pin-Priority: 999

  Package: gitosis
  Pin: release a=etch-backports
  Pin-Priority: 999

  Package: gitweb
  Pin: release a=etch-backports
  Pin-Priority: 999

  Package: devscripts
  Pin: release a=etch-backports
  Pin-Priority: 999
  EOF

Direct installation will fail due to problem in python-setuptools
(0.6c8-4~bpo40+1), therefor manual intervention through dpkg.

  aptitude install git-core git-buildpackage gitosis devscripts gitweb
  dpkg -i /var/cache/apt/archives/python-setuptools_0.6c8-4\~bpo40+1_all.deb
  aptitude install git-core git-buildpackage gitosis devscripts gitweb

Setup apache2
-------------

See also /usr/share/doc/git-core/README.Debian

  aptitude install apache2

  $EDITOR /etc/apache2/sites-available/default
  [...]
  <VirtualHost *:80>
          ServerName git.grml.org
          ServerAdmin git@grml.org

          ErrorLog /var/log/apache2/git_error.log
          CustomLog /var/log/apache2/git_access.log combined
          ServerSignature On

          HeaderName HEADER
          # bogus but safe DocumentRoot
          DocumentRoot /home/git/repositories

          Alias /gitweb.css /usr/share/gitweb/gitweb.css
          Alias /git-favicon.png /usr/share/gitweb/git-favicon.png
          Alias /git-logo.png /usr/share/gitweb/git-logo.png
          Alias /icons /usr/share/apache2/icons/
          Alias /git /var/cache/git
          ScriptAlias / /usr/lib/cgi-bin/gitweb.cgi
          RedirectMatch permanent "^/~(.*)$" "http://example.org/~$1"
  </VirtualHost>

Configure gitweb
----------------

  $EDITOR /etc/gitweb.conf
  [...]
  $projectroot = "/home/git/repositories";
  $projects_list = "/home/git/gitosis/projects.list";
  @git_base_url_list = "git://git.grml.org";

  # By default, gitweb will happily let people browse any repository
  # they guess the name of. This may or may not be what you wanted.  I
  # choose to allow gitweb to show only repositories that git-daemon
  # is already sharing anonymously.
  $export_ok = "git-daemon-export-ok";

  #$projectroot = "/srv/gitosis/repositories";
  #$projects_list = "/srv/gitosis/gitosis/projects.list";
  #@git_base_url_list = "git://git.grml.org";

User setup
----------

  usermod --shell /bin/false gitosis # disable user gitosis, use git instead:
  addgroup git
  adduser --system --home /home/git --shell /bin/sh --disabled-password --gecos 'git repository hosting' --ingroup git git
  sudo -H -u git gitosis-init < /home/mika/.ssh/id_rsa.pub
  chgrp -R www-data /home/git

Configuration of gitosis-admin
------------------------------

Clone gitosis-admin to client via executing the following
command line on the client with the id_rsa.pub key:

  git clone ssh://git@git.grml.org/gitosis-admin.git

Edit gitosis.conf of gitosis-admin repository:

  [gitosis]
  gitweb = yes
  gitdaemon = yes

  [group gitosis-admin]
  writable = gitosis-admin
  members = mika@tweety

  [group mika]
  writable = testrepo
  members = mika@tweety

And push changes:

  git commit -a -m 'add testrepo with user mika@tweety'
  git push

Create test repository on client:

  cd /tmp
  mkdir testrepo
  cd testrepo
  git init
  git remote add origin git@git.grml.org:testrepo.git
  echo testfile > testfile
  git add testfile
  git commit -a -m 'initial checkin'
  git push origin

Setup of git-daemon
-------------------

Make repositories available via git protocol:

  cd /etc/init.d
  wget http://grml.org/git/git-daemon
  chmod +x ./git-daemon
  /etc/init.d/git-daemon start
